{% extends 'index.html' %}
{% block content %}
<div class="container mt-5">
    <h2>Podcast Service Run History</h2>
    <p class="text-muted">Last 50 runs</p>
    
    {% if error %}
    <div class="alert alert-danger">
        <i class="bi bi-exclamation-triangle me-2"></i>
        Error loading run history: {{ error }}
    </div>
    {% endif %}
    
    {% if runs %}
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Timestamp</th>
                    <th>Type</th>
                    <th>Status</th>
                    <th>Message</th>
                </tr>
            </thead>
            <tbody>
                {% for run in runs %}
                <tr>
                    <td>{{ run[0] }}</td>
                    <td>
                        {% if run[1] == 'manual' %}
                            <span class="badge bg-primary">Manual</span>
                        {% elif run[1] == 'scheduled' %}
                            <span class="badge bg-info">Scheduled</span>
                        {% elif run[1] == 'process' %}
                            <span class="badge bg-secondary">Process</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ run[1] }}</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if run[2] == 'started' %}
                            <span class="badge bg-warning text-dark">Started</span>
                        {% elif run[2] == 'completed' %}
                            <span class="badge bg-success">Completed</span>
                        {% elif run[2] == 'error' %}
                            <span class="badge bg-danger">Error</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ run[2] }}</span>
                        {% endif %}
                    </td>
                    <td>{{ run[3] or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% elif not error %}
    <div class="alert alert-info">
        <i class="bi bi-info-circle me-2"></i>
        No run history found. Run history will appear here after the podcast service runs.
        <br><br>
        <strong>Tip:</strong> Go to the <a href="/task" class="alert-link">Task Control</a> page and click "Run Once" or "Start Background Task" to see entries here.
    </div>
    {% endif %}
</div>

<script>
// Auto-refresh every 10 seconds
setInterval(function() {
    location.reload();
}, 10000);
</script>
{% endblock %}
